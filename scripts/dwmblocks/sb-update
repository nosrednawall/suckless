#!/bin/bash

# Carrega as cores do tema
source ~/.theme_selected

# funcoes cliclaveis
case $BUTTON in
    1) st -n "updates" -e sh -c "sudo pacman -Syuv ; kill -36 $(pidof dwmblocks)" & ;;
    3) x-www-browser "https://flathub.org/" ;;
    6) setsid -f st -e emacs -nw "$0" ;;
esac

# L√™ o nome da distribui√ß√£o a partir do arquivo /etc/os-release
if [ -f /etc/os-release ]; then
    . /etc/os-release
    case "$ID" in
        arch)
            updates=$(checkupdates | wc -l)
            ;;

        debian)
            updates=$(apt list --upgradable 2>/dev/null | grep -c 'upgradable')
            ;;
        *)
            echo "Sistema desconhecido ou n√£o suportado: $ID"
            ;;
    esac
else
    echo "N√£o foi poss√≠vel determinar a distribui√ß√£o. O arquivo /etc/os-release n√£o existe."
fi

icon="^c$COLOR_5^üì¶^d^"

if [ "$updates" -eq 0 ]; then
    echo "$icon 0  "
else
    echo "$icon $updates  "
    notify-send -i "/usr/share/icons/Adwaita/24x24/legacy/software-update-available.png" "Û±ßï Atualiza√ß√£o Dispon√≠vel" "Existem <b>$updates</b> atualiza√ß√µes dispon√≠veis."
fi
